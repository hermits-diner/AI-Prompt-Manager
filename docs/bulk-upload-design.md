# 프롬프트 일괄 업로드 설계

## 1. 목표
- 여러 개의 프롬프트를 한 번에 추가할 수 있는 기능
- JSON 파일, CSV 파일, 클립보드 붙여넣기 지원

---

## 2. 지원 입력 방식

| 방식 | 설명 | 권장 포맷 |
|------|------|------------|
| **JSON 파일** | `.json` 파일 업로드 | 배열 형태의 프롬프트 데이터 |
| **CSV 파일** | `.csv` 파일 업로드 | 제목, 내용, 카테고리, 태그 컬럼 |
| **붙여넣기** | 텍스트 영역에 JSON/CSV 붙여넣기 | 파일과 동일 포맷 |

---

## 3. 데이터 포맷

### 3.1 JSON 포맷

```json
[
  {
    "title": "프롬프트 제목",
    "content": "프롬프트 본문 내용...",
    "category": "카테고리명",
    "tags": ["태그1", "태그2"]
  }
]
```

- **필수**: `title`, `content`
- **선택**: `category` (없으면 `"미분류"`), `tags` (없으면 `[]`)
- `tags`는 문자열 배열. 문자열 하나면 `["태그1"]`로 처리

### 3.2 CSV 포맷

```csv
title,content,category,tags
제목1,내용1,카테고리A,"태그1|태그2"
제목2,내용2,카테고리B,
```

- **헤더**: 첫 줄은 `title,content,category,tags` (순서 고정)
- **인코딩**: UTF-8
- **내용에 쉼표/줄바꿈 포함 시**: 해당 필드를 큰따옴표로 감싸기
- **태그**: 한 셀 안에서 `|`로 구분 (예: `태그1|태그2`)
- **빈 행**: 무시

---

## 4. UI 구성

### 4.1 진입점
- **헤더** "새 프롬프트" 버튼 옆에 **"일괄 가져오기"** 버튼 추가
- 아이콘: `Upload` 또는 `FileInput` (lucide-react)

### 4.2 일괄 가져오기 다이얼로그

1. **탭 또는 토글**
   - "파일 업로드" / "붙여넣기"

2. **파일 업로드**
   - 드래그 앤 드롭 영역
   - "파일 선택" 버튼 → `.json`, `.csv`만 허용
   - 선택된 파일명 표시, 제거 버튼

3. **붙여넣기**
   - 큰 텍스트 영역 (placeholder: JSON 또는 CSV 형식 안내)
   - 포맷 자동 감지: 첫 문자가 `[` 이면 JSON, 아니면 CSV 시도

4. **미리보기 (선택)**
   - 파싱 결과 상위 N건(예: 5건) 테이블로 표시
   - 컬럼: 제목, 카테고리, 태그 개수
   - 오류 행이 있으면 "N건 중 M건 유효" 형태로 표시

5. **액션**
   - "가져오기" 버튼 → 유효한 항목만 일괄 추가
   - "취소" 버튼 → 다이얼로그 닫기
   - 성공 시 토스트: "N개의 프롬프트를 가져왔습니다."
   - 오류 시 토스트: "일부 항목을 건너뛰었습니다." + 필요 시 상세 메시지

---

## 5. 백엔드(훅) 변경

### 5.1 `usePrompts` 확장

```ts
// 추가할 함수
addPrompts(dataList: PromptFormData[]): number
```

- `PromptFormData[]`를 받아서 각 항목에 `id`, `createdAt`, `updatedAt`, `favorite` 부여 후 한 번에 `setPrompts` 갱신
- 반환값: 실제로 추가된 개수 (중복 제거 시 사용 가능)

### 5.2 파싱/검증 유틸 (새 파일)

- `src/lib/importPrompts.ts` 또는 `src/utils/parseBulkPrompts.ts`
  - `parseJsonImport(text: string): PromptFormData[]`
  - `parseCsvImport(text: string): PromptFormData[]`
  - `validateAndNormalize(items: unknown[]): PromptFormData[]`
    - title/content 빈 문자열 제거, category/tags 기본값 처리
    - 잘못된 행은 걸러 내고 유효한 것만 반환

---

## 6. 처리 규칙

| 항목 | 규칙 |
|------|------|
| **제목/내용** | 둘 다 비어 있으면 해당 행 스킵 |
| **카테고리** | 없거나 빈 문자열 → `"미분류"` |
| **존재하지 않는 카테고리명** | 그대로 저장 (카테고리 관리에서 나중에 정리 가능) |
| **태그** | 없으면 `[]`, 문자열이면 `[문자열]`, 배열이면 그대로 사용 (문자열만 허용) |
| **중복** | 제목 기준 중복 검사는 1차 구현에서 생략 (전부 추가). 필요 시 이후 옵션으로 "제목 같은 건 스킵" 추가 |

---

## 7. 구현 순서 제안

1. **훅**: `usePrompts`에 `addPrompts` 추가
2. **유틸**: JSON/CSV 파서 + `validateAndNormalize` 작성
3. **UI**: `BulkImportDialog` 컴포넌트 (파일 업로드 + 붙여넣기 + 미리보기)
4. **연결**: `App.tsx`에서 "일괄 가져오기" 버튼 및 다이얼로그 연결
5. **(선택)** CSV 다운로드 템플릿 링크 제공

---

## 8. 예시: JSON 샘플

```json
[
  {
    "title": "학습지 문항 생성",
    "content": "다음 주제로 초등 3학년 수준의 학습지 문항 5개를 만들어 주세요.",
    "category": "학습지출제",
    "tags": ["학습지", "문항"]
  },
  {
    "title": "학생 칭찬 문구",
    "content": "수업 참여가 좋았던 학생에게 쓸 칭찬 문구를 3가지 제안해 주세요.",
    "category": "학생상담",
    "tags": []
  }
]
```

---

## 9. 예시: CSV 샘플

```csv
title,content,category,tags
학습지 문항 생성,"다음 주제로 초등 3학년 수준의 학습지 문항 5개를 만들어 주세요.",학습지출제,"학습지|문항"
학생 칭찬 문구,수업 참여가 좋았던 학생에게 쓸 칭찬 문구를 3가지 제안해 주세요.,학생상담,
```

이 설계를 기준으로 컴포넌트와 훅을 구현하면 됩니다.
